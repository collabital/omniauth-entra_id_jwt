<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <title>Code coverage for Omniauth-entra id jwt</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <script src='./assets/0.13.1/application.js' type='text/javascript'></script>
    <link href='./assets/0.13.1/application.css' media='screen, projection, print' rel='stylesheet' type='text/css' />
    <link rel="icon" type="image/png" href="./assets/0.13.1/favicon_green.png" />
  </head>

  <body>
    <div id="loading">
      <img src="./assets/0.13.1/loading.gif" alt="loading"/>
    </div>
    <div id="wrapper" class="hide">
      <div class="timestamp">Generated <abbr class="timeago" title="2025-06-20T01:26:24+00:00">2025-06-20T01:26:24+00:00</abbr></div>
      <ul class="group_tabs"></ul>

      <div id="content">
        <div class="file_list_container" id="AllFiles">
  <h2>
    <span class="group_name">All Files</span>
    (<span class="covered_percent">
      <span class="green">
  100.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         42.42
       </span>
    </span> hits/line
    )
  </h2>

  <a name="AllFiles"></a>

  <div>
    <b>2</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>62</b> relevant lines,
    <span class="green"><b>62</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed. </span>
    (<span class="green">
  100.0%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#0592804a777fbe43cb0f86915267e6d33ddf9234" class="src_link" title="lib/omniauth/entra_id_jwt.rb">lib/omniauth/entra_id_jwt.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">2</td>
            <td class="cell--number">2</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#388c733481cefa33d56de4c678ba546ad33c87e6" class="src_link" title="lib/omniauth/strategies/entra_id_jwt.rb">lib/omniauth/strategies/entra_id_jwt.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">138</td>
            <td class="cell--number">60</td>
            <td class="cell--number">60</td>
            <td class="cell--number">0</td>
            <td class="cell--number">43.80</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>


        
      </div>

      <div id="footer">
        Generated by <a href="https://github.com/simplecov-ruby/simplecov">simplecov</a> v0.22.0
        and simplecov-html v0.13.1<br/>
        using RSpec
      </div>

      <div class="source_files">
      
        <div class="source_table" id="0592804a777fbe43cb0f86915267e6d33ddf9234">
  <div class="header">
    <h3>lib/omniauth/entra_id_jwt.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>2</b> relevant lines.
      <span class="green"><b>2</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">require File.join(&quot;omniauth&quot;, &quot;entra_id_jwt&quot;, &quot;version&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">require File.join(&quot;omniauth&quot;, &quot;strategies&quot;, &quot;entra_id_jwt&quot;)</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="388c733481cefa33d56de4c678ba546ad33c87e6">
  <div class="header">
    <h3>lib/omniauth/strategies/entra_id_jwt.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>60</b> relevant lines.
      <span class="green"><b>60</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">require &quot;omniauth-oauth2&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">module OmniAuth</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  module Strategies</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    class EntraIdJWT &lt; OmniAuth::Strategies::OAuth2</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      BASE_URL = &quot;https://login.microsoftonline.com&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      option :name, &quot;entra_id_jwt&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="11">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      option :tenant_provider, nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="13">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      DEFAULT_SCOPE    = &quot;openid profile email&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="14">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      COMMON_TENANT_ID = &quot;common&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            

            <code class="ruby">      # The tenant_provider must return client_id, client_secret and,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            

            <code class="ruby">      # optionally, tenant_id and base_url.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            

            <code class="ruby">      #</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="19">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      args [:tenant_provider]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="21">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      def client</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="63" data-linenumber="22">
            
              <span class="hits">63</span>
            

            

            <code class="ruby">        provider = options.tenant_provider ? options.tenant_provider.new(self) : options</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="63" data-linenumber="23">
            
              <span class="hits">63</span>
            

            

            <code class="ruby">        options.client_id = provider.client_id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="63" data-linenumber="25">
            
              <span class="hits">63</span>
            

            

            <code class="ruby">        unless provider.respond_to?(:client_secret) &amp;&amp; provider.client_secret</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="26">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">          raise ArgumentError, &quot;You must provide client_secret&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="29">
            
              <span class="hits">62</span>
            

            

            <code class="ruby">        options.client_secret = provider.client_secret</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="31">
            
              <span class="hits">62</span>
            

            

            <code class="ruby">        tenant_id = provider.respond_to?(:tenant_id) ? provider.tenant_id : COMMON_TENANT_ID</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="32">
            
              <span class="hits">62</span>
            

            

            <code class="ruby">        base_url =  provider.respond_to?(:base_url) ? provider.base_url : BASE_URL</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="34">
            
              <span class="hits">62</span>
            

            

            <code class="ruby">        options.authorize_params = provider.authorize_params if provider.respond_to?(:authorize_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="35">
            
              <span class="hits">62</span>
            

            

            <code class="ruby">        options.token_params.scope = if defined?(request) &amp;&amp; request.params[&quot;scope&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="36">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">                                       request.params[&quot;scope&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="61" data-linenumber="37">
            
              <span class="hits">61</span>
            

            

            <code class="ruby">                                     elsif provider.respond_to?(:scope) &amp;&amp; provider.scope</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="38">
            
              <span class="hits">29</span>
            

            

            <code class="ruby">                                       provider.scope</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            

            <code class="ruby">                                     else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="40">
            
              <span class="hits">32</span>
            

            

            <code class="ruby">                                       DEFAULT_SCOPE</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            

            <code class="ruby">                                     end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="42">
            
              <span class="hits">62</span>
            

            

            <code class="ruby">        oauth2 = &quot;oauth2/v2.0&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="44">
            
              <span class="hits">62</span>
            

            

            <code class="ruby">        tenanted_endpoint_base_url = &quot;#{base_url}/#{tenant_id}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="46">
            
              <span class="hits">62</span>
            

            

            <code class="ruby">        options.client_options.authorize_url = &quot;#{tenanted_endpoint_base_url}/#{oauth2}/authorize&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="47">
            
              <span class="hits">62</span>
            

            

            <code class="ruby">        options.client_options.token_url     = &quot;#{tenanted_endpoint_base_url}/#{oauth2}/token&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            

            <code class="ruby">        # On Behalf Of flow requires the default as the grant_type, so should only need to be configured</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            

            <code class="ruby">        # in the provider (if at all).</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="51">
            
              <span class="hits">62</span>
            

            

            <code class="ruby">        options.token_params.grant_type = if provider.respond_to?(:grant_type) &amp;&amp; provider.grant_type</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="52">
            
              <span class="hits">29</span>
            

            

            <code class="ruby">                                            provider.grant_type</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            

            <code class="ruby">                                          else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="33" data-linenumber="54">
            
              <span class="hits">33</span>
            

            

            <code class="ruby">                                            grant_type</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            

            <code class="ruby">                                          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            

            <code class="ruby">        # On Behalf Of flow requires the default as the requested_token_use, so should only need to be configured</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            

            <code class="ruby">        # in the provider (if at all).</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="59">
            
              <span class="hits">62</span>
            

            

            <code class="ruby">        options.token_params.requested_token_use = if provider.respond_to?(:requested_token_use) &amp;&amp; provider.requested_token_use</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="60">
            
              <span class="hits">29</span>
            

            

            <code class="ruby">                                                     provider.requested_token_use</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            

            <code class="ruby">                                                   else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="33" data-linenumber="62">
            
              <span class="hits">33</span>
            

            

            <code class="ruby">                                                     requested_token_use</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            

            <code class="ruby">                                                   end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="65">
            
              <span class="hits">62</span>
            

            

            <code class="ruby">        super</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="68">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      uid do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="44" data-linenumber="69">
            
              <span class="hits">44</span>
            

            

            <code class="ruby">        raw_info[&quot;userPrincipalName&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            

            <code class="ruby">      # As per omniauth-microsoft_graph definition</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            

            <code class="ruby">      # https://github.com/omniauth/omniauth/wiki/Auth-Hash-Schema</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="74">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      info do</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            

            <code class="ruby">        {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="52" data-linenumber="76">
            
              <span class="hits">52</span>
            

            

            <code class="ruby">          &quot;name&quot; =&gt;       [raw_info[&quot;givenName&quot;], raw_info[&quot;surname&quot;]].join(&#39; &#39;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            

            <code class="ruby">          &quot;email&quot; =&gt;      raw_info[&quot;mail&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            

            <code class="ruby">          &quot;first_name&quot; =&gt; raw_info[&quot;givenName&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            

            <code class="ruby">          &quot;last_name&quot; =&gt;  raw_info[&quot;surname&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            

            <code class="ruby">          &quot;nickname&quot; =&gt;   raw_info[&quot;displayName&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            

            <code class="ruby">          &quot;phone&quot; =&gt;      raw_info[&quot;mobilePhone&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            

            <code class="ruby">      # Although the only extra referred to in https://github.com/omniauth/omniauth/wiki/Auth-Hash-Schema</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            

            <code class="ruby">      # is raw_info, include other useful information such as tenant identifier as other keys.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            

            <code class="ruby">      # Probably best not to merge them all into the raw_info key, so they remain different.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="89">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      extra do</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            

            <code class="ruby">        {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="91">
            
              <span class="hits">62</span>
            

            

            <code class="ruby">          &#39;raw_info&#39; =&gt; raw_info,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            

            <code class="ruby">          &#39;params&#39; =&gt; access_token.params,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            

            <code class="ruby">          &#39;aud&#39; =&gt; options.client_id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            

            <code class="ruby">          &#39;tid&#39; =&gt; @jwt_data[&quot;tid&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="98">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      def callback_url</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="99">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">        raise NotImplementedError, &quot;Callback URL is not supported in on behalf of flow&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="102">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      def raw_info</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="470" data-linenumber="103">
            
              <span class="hits">470</span>
            

            

            <code class="ruby">        @raw_info = access_token.request(:get, &quot;https://graph.microsoft.com/v1.0/me&quot;).parsed if @raw_info.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="470" data-linenumber="104">
            
              <span class="hits">470</span>
            

            

            <code class="ruby">        @raw_info</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="107">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      def callback_phase</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="44" data-linenumber="108">
            
              <span class="hits">44</span>
            

            

            <code class="ruby">        options.provider_ignores_state = true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="44" data-linenumber="109">
            
              <span class="hits">44</span>
            

            

            <code class="ruby">        super</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="112">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      protected</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="114">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      def grant_type</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="33" data-linenumber="115">
            
              <span class="hits">33</span>
            

            

            <code class="ruby">        &quot;urn:ietf:params:oauth:grant-type:jwt-bearer&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="118">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      def requested_token_use</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="33" data-linenumber="119">
            
              <span class="hits">33</span>
            

            

            <code class="ruby">        &quot;on_behalf_of&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            

            <code class="ruby">      # This requires examining the request body, as it is almost definitely delivered as</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            

            <code class="ruby">      # ContentType application/json</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="124">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      def build_access_token</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="44" data-linenumber="125">
            
              <span class="hits">44</span>
            

            

            <code class="ruby">        body = JSON.parse(request.body.read)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="43" data-linenumber="126">
            
              <span class="hits">43</span>
            

            

            <code class="ruby">        request.body.rewind</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            

            

            <code class="ruby">        # Need to store the JWT token here, as otherwise the actual tenant (tid)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            

            <code class="ruby">        # is not found in the subsequent /me API call.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            

            <code class="ruby">        # Check for tid claim, as it will be useful.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="43" data-linenumber="130">
            
              <span class="hits">43</span>
            

            

            <code class="ruby">        @jwt_data = JWT.decode(body[&#39;code&#39;], nil, false, { required_claims: &quot;tid&quot; })[0]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="42" data-linenumber="132">
            
              <span class="hits">42</span>
            

            

            <code class="ruby">        client.get_token({ assertion: body[&#39;code&#39;] }.merge(token_params))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="138">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">OmniAuth.config.add_camelization &#39;entra_id_jwt&#39;, &#39;EntraIdJWT&#39;</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
      </div>
    </div>
  </body>
</html>
